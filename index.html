<!DOCTYPE html>
 <html>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/select/1.2.7/css/select.dataTables.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.5.2/css/buttons.dataTables.min.css" />
    <link rel='shortcut icon' type='image/x-icon' href='favicon.ico' />
<style>
.loader {
    border: 16px solid #f3f3f3; /* Light grey */
    border-top: 16px solid #3498db; /* Blue */
    border-radius: 50%;
    width: 0.5em;
    height: 0.5em;
    animation: spin 2s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

table.dataTable.compact {
    table-layout: fixed;
    word-wrap:break-word;
    font-size: 10pt;
}

table.dataTable.compact tbody>tr.odd.selected {
    background-color: #DDD;
}
table.dataTable.compact tbody>tr.even.selected {
    background-color: #DDD;
}

#main {
    width: 1030px;
    border: 1px solid black;
    margin: auto;
    background: #ffffff;
    overflow: auto;
}

#banner {
    text-align:center;
    padding-left: 50px;
    padding-right: 50px;
}   

#footer {
    text-align:center;
    font-size: 10pt;
    background-color: #eeeeee;
    margin: auto;
    border: 1px solid black;
    width: 1030px;
}

body {
    background: #333333;
    background: -webkit-linear-gradient(#668888, #333333);
    background:    -moz-linear-gradient(#668888, #333333);
    background:         linear-gradient(#668888, #333333);
}
#labels {
    height:450px;
    width:300px;
    border:2px solid;
    float:left;
    padding: 10px;
    margin: 10px;
    overflow-y: auto;
    overflow-x: auto;
}

#instructions {
    margin: 10px;
    border: 2px solid black;
    padding: 10px;
}

</style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0-alpha1/jquery.min.js"></script>
    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/0.71/jquery.csv-0.71.min.js"></script>-->
    <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/select/1.2.7/js/dataTables.select.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.5.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.flash.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.html5.min.js"></script>
    <script src="fft.js"></script>
	<script src="papaparse.min.js"></script>
    <script src="colorlist.js"></script>
    <script src="canvas.js"></script>
    <script src="slowmoman_datatable.js"></script>
    <script src="slowmoman_canvas.js"></script>
    <body onload="init()">
    <div id="main">
        <div id="banner">
            <img src="SlowMoMan.png" height="100" align="left" />
            <img src="SlowMoMan.png" height="100" align="right" />
            <h1>SlowMoMan</h1>
            <p><em>Yun William Yu, Ph.D. and Griffin Weber, M.D./Ph.D.</em></p>
            <p>Feature selection on 2D embeddings of manifolds using slow vibrational modes</p>
        </div>
        <hr />
        <div id="instructions">
            <h2>Greetings!</h2>
            <p>Welcome to SlowMoMan (slow modes on manifolds), a Javascript webtool for doing feature selection on 2D embeddings of manifolds by finding the features that have the slowest vibrational modes across some user-drawn path.</p>
            
            <p>Nonlinear low-dimensional embeddings (such as van der Maaten and Hinton's <a href="https://lvdmaaten.github.io/tsne/">t-SNE</a>) are great for visualizing high-dimensional data, allowing humans to see shapes and clusters in the data. Unfortunately, interpreting those embeddings can be a bit trickier because the axes of the embedding cannot be directly related to the original features of interest. We can see patterns in the embedding, but figuring out what those patterns correspond to in the original data is much harder. </p>

            <p>SlowMoMan solves this problem by allowing the user to draw a path (or using fancy mathematical terms, 1D manifold) directly onto a 2D embedding. Then, it backprojects using a nearest neighbors algorithm up to a high dimensional space where each dimension/variable is a potential feature of interest. SlowMoMan does a Fast Fourier Transform on each variable as it varies along that manifold, and computes an FFT score defined as the harmonic sum of FFT magnitudes. We thus weight the low freqencies much more highly, favoring features that vary slowly along the manifold.</p>
            
            <h2>Pre-requisites</h2>
            <p>Before getting started, note that SlowMoMan does all computation locally, so you'll need a fast enough computer. We recommend a machine with at least 4 GiB of RAM and a browser that includes a modern Javascript rendering engine. We've tested on <a href="https://www.mozilla.org/en-US/firefox/">Firefox</a> 65, <a href="https://www.google.com/chrome/">Chrome</a> 71, and <a href="https://www.microsoft.com/en-us/windows/microsoft-edge">Edge</a> 44, but any modern browser should work. Notably, this does <em>not</em> include Internet Explorer, which has been deprecated.</p>

            <h2>Getting started</h2>
            <p>First, we want to emphasize that you're not actually uploading any data to our servers. Everything is done on your own computer. In fact, if you're paranoid, you can disconnect from the network once you've loaded this page; everything will still work. However, the flip-side is that you'll have to download our example data files locally. We provide three sets of examples.</p>

            <ol>
                <li>Pick one of the three examples.
                <li>Download both 2D TSNE embedding and the high dimensional features/variables from the list below.</li>
                <li>Choose the TSNE file as the "2D embedding CSV file" in the first box.</li>
                <li>Choose the other high dimensional data file as the "original space CSV file".</li>
                <li>Draw a path in the box below by holding down the left mouse button and dragging.</li>
                <li>Click "Compute Important Variables via FFT."</li>
                <li>SlowMoMan then lists out the important variables in the table below, and graphs them in the box in the lower right.</li>
                <li>You can select different variables to view, either individually, or together by shift/ctrl clicking in the table.</li>
                <li>Hitting "Reset Path" will erase the path you drew, but keep the data loaded.</li>
                <li>If you want to try one of the other examples, you can upload those data as well, though sometimes uploading multiple data files in succession will crash the page because of using up too much memory. For safety and lower memory consumption, we recommend refreshing the page when you load new data.</li>
                <li>If you want to save a path you've previously drawn, just copy and paste out the "Path points" textbox. To reload a previous path, hit "Toggle text input", paste a list of points back in, and hit "Toggle text input" one more time to draw the new path.</li>
            </ol>

            <h3>Swiss Roll</h3>
            <p>
            <a href="examples/swissroll/swissroll-2Dtsne.csv">TSNE</a>
            <br />
            <a href="examples/swissroll/swissroll-features.csv">Original data</a>
            </p>

            <h3>Fashion MNIST</h3>
            <p>
            <a href="examples/fashion-mnist/fashion-mnist-2Dtsne.csv">TSNE</a>
            <br />
            <a href="examples/fashion-mnist/fashion-mnist-features.csv">Trained CNN node activations in final layer</a>
            </p>

            <h3>Human Microbiome Project</h3>
            <p>
            <a href="examples/human-microbiome/human-microbiome-project-2Dtsne.csv">TSNE</a>
            <br />
            <a href="examples/human-microbiome/human-microbiome-project-features1000.csv">First 1000 OTUs data file</a> (smaller high dimensional data file that has most of the important variables for easier downloading and faster computation. Recommended for playing around with SlowMoMan).
            <br />
            <a href="http://static.ywyu.net/hmp1_labeled.csv">All 27,655 OTUs data file</a> (file is really large, at 189 MiB, and computation will take up to a few minutes on a slow computer).
            </p>




        </div>
        <hr />
        <div id="dvImportSegments" class="fileupload ">
            <fieldset>
                <legend>Upload your 2D embedding CSV File (e.g. *-2Dtsne.csv), with columns labeled "X" and "Y" for coordinates, and optionally "class" and "desc".</legend>
                <input type="file" name="File Upload" id="txtFileUpload" style="width:400px" accept=".csv" />
                <progress id="progress1" value="0"> </progress>
                <span id="fmessage1"> </span>
            </fieldset>
        </div>
        <div id="dvImportSegments2" class="fileupload ">
            <fieldset>
                <legend>Upload your original space CSV File (e.g. *-features*.csv), with headers specifying variable names</legend>
                <input type="file" name="File Upload" id="txtFileUpload2" style="width:400px" accept=".csv" />
                <progress id="progress2" value="0"> </progress>
                <span id="fmessage2"> </span>
            </fieldset>
        </div>
        <div id="labels"><strong>Labels (if any)</strong><hr /></div>
        Draw a path of interest on the canvas below:<br />
        <canvas id="can" width="512" height="512" style="border:2px solid;"></canvas>
        <!--<input type="button" value="Clear All" id="clr" style="display: block; float: left; padding:10px; font-size:24px;" onclick="location.reload()">-->
        <div id="pt_div" style="height:500px; width: 10em; float:right;">
            <strong>Path points</strong>
            <input type="button" value="Toggle text input" id="togglepath" onclick="togglePathPoints()" />
            <textarea id="points" style="height:15em; width:10em; border: 2px solid; overflow-y: scroll;" disabled="true"></textarea>
            <div id="preview" style="height: 200px; width:9.5em; border: 1px solid black">
                &nbsp;
            </div>
        </div>
        <br />
            &nbsp;
        <button class="dt-button buttons-html5" id="fft" onclick="fft_call()">Compute Important Variables via FFT</button>
        <progress id="fft_progress" value="0"></progress>
        <button class="dt-button buttons-html5" id="res" onclick="reset()">Reset Path</button><span id="fft_error"></span>
        <br />
        <div style="width: 512px; float: left; border: 1px solid;">
        <table id="variables" class="compact" style="width:100%;" title="Use shift and control to select multiple rows">
            <thead>
                <tr>
                    <th>Label</th>
                    <th>Color</th>
                    <th>Variable</th>
                    <th title="Harmonic sum of fft components">FFT</th>
                </tr>
            </thead>
            <tbody id="variable_body">
            </tbody>
        </table>
        </div>
        <canvas id="can2" width="512" height="512" style="border:2px solid;"></canvas>
        <br />
    </div>
    <div id="footer">
        <p>Copyright &copy; 2019 Yun William Yu. All rights reserved.</p>
    </div>
    </body>
    </html>
